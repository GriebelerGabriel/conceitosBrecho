<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link type="text/javascript" src="shim.min.js">
    <link type="text/javascript" src="xlsx.full.min.js">

    <title>Importar</title>
</head>

<body onload="readData()">
    <script src="../js/jquery-1.11.3.js"></script>
    <div id="rodape" class="principal">
        <a href='/menu'><img src='/logo.jpeg'></a>
    </div>

    <div id="barra-principal">

        <button class="button-top"> <a href='/menu'>Home</a></button>

        <div class="dropdown-top">

            <button class="button-top">Produto</button>

            <div class="dropdown-top-conteudo">
                <a href='/menu/cadastro-produto'>Cadastrar</a>
                <a href='/menu/listar-produtos'>Listar</a></button>
                <a href='/menu/importar-produtos'>Importar</a>
            </div>
        </div>

        <div class="dropdown-top">
            <button class="button-top">Despesa</button>
            <div class="dropdown-top-conteudo">
                <a href='/menu/cadastro-despesa'>Cadastrar</a>
                <a href='/menu/listar-despesas'>Listar</a></button>
                <a href='/menu/importar-despesas'>Importar</a>
            </div>
        </div>

        <div class="dropdown-top">
            <button class="button-top">Fornecedor</button>
            <div class="dropdown-top-conteudo">
                <a href='/menu/cadastro-fornecedor'>Cadastrar</a>
                <a href='/menu/listar-fornecedores'>Listar</a></button>
                <a href='/menu/importar-fornecedores'>Importar</a>
            </div>
        </div>
        <button class="button-top"> <a href='/sobre'>Sobre</a></button>
    </div>

    <strong>
        <h1>COMPRA:<label id="#COMPRA"></label></h1>
    </strong>
    <strong>
        <h1>VENDA:<label id="#VENDA"></label></h1>
    </strong>
    <strong>
        <h1>LUCRO:<label id="#LUCRO"></label></h1>
    </strong>

<script>
    function readData() {
        var compra = 0;
        var venda = 0;

        var xhttp = new XMLHttpRequest(); //REQUEST pra buscar os valores dos produtos vendidos

        var tipo = "POST"
        /*
        tipo pode ser POST, GET, DELETE, PATCH depende do que vc quer
        */

        var url = "/menu/sendDadosVendidos";

        xhttp.open(tipo, url, true);
        xhttp.setRequestHeader("Content-type", "application/json");

        var body = {}

        xhttp.send(JSON.stringify(body));

        // ---------- Resposta da requisição feita acima ---------------//

        xhttp.onreadystatechange = function () {
            
            if (this.readyState == 4 && this.status == 200) {
                
                resposta = JSON.parse(this.responseText);
                
                for (x = 0; x < resposta.length; x++) {
                    if((resposta[x].pago == 'OK') || (resposta[x].pago == 'OK/PL')){
                        venda += resposta[x].preco_venda
                    }
                }
                document.getElementById("#VENDA").innerHTML = venda;
            }
        }

        var xhttp = new XMLHttpRequest(); //REQUEST pra buscar os valores das despesas de compra

        var tipo = "POST"
        /*
        tipo pode ser POST, GET, DELETE, PATCH depende do que vc quer
        */

        var url = "/menu/sendDadosDespesas";

        xhttp.open(tipo, url, true);
        xhttp.setRequestHeader("Content-type", "application/json");

        var body = {}

        xhttp.send(JSON.stringify(body));

        // ---------- Resposta da requisição feita acima ---------------//

        xhttp.onreadystatechange = function () {
            
            if (this.readyState == 4 && this.status == 200) {
        
                resposta = JSON.parse(this.responseText);
                
                for (x = 0; x < resposta.length; x++){
                    compra += (resposta[x].valor);
                }
                document.getElementById("#COMPRA").innerHTML = compra;
            }
        }
        document.getElementById("#LUCRO").innerHTML = document.getElementById("#COMPRA").innerHTML;
    }
</script>
</body>

</html>